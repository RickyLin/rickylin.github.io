<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ç¬¬ 6 é¡µ | Ricky Lin</title>
  <meta name="author" content="Ricky Lin">
  
  <meta name="description" content="è¿™æ˜¯ Ricky Lin çš„åšå®¢ç«™ç‚¹">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Ricky Lin"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/cerulean.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight-default.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/comment.css" media="screen" type="text/css">
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-sham.min.js"></script>
  <![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  
  <!-- analytics -->
  




  <script type="text/javascript">
    var sdkInstance="appInsightsSDK";window[sdkInstance]="appInsights";var aiName=window[sdkInstance],aisdk=window[aiName]||function(e){
      function n(e){t[e]=function(){var n=arguments;t.queue.push(function(){t[e].apply(t,n)})}}var t={config:e};t.initialize=!0;var i=document,a=window;setTimeout(function(){var n=i.createElement("script");n.src=e.url||"https://az416426.vo.msecnd.net/next/ai.2.min.js",i.getElementsByTagName("script")[0].parentNode.appendChild(n)});try{t.cookie=i.cookie}catch(e){}t.queue=[],t.version=2;for(var r=["Event","PageView","Exception","Trace","DependencyData","Metric","PageViewPerformance"];r.length;)n("track"+r.pop());n("startTrackPage"),n("stopTrackPage");var s="Track"+r[0];if(n("start"+s),n("stop"+s),n("setAuthenticatedUserContext"),n("clearAuthenticatedUserContext"),n("flush"),!(!0===e.disableExceptionTracking||e.extensionConfig&&e.extensionConfig.ApplicationInsightsAnalytics&&!0===e.extensionConfig.ApplicationInsightsAnalytics.disableExceptionTracking)){n("_"+(r="onerror"));var o=a[r];a[r]=function(e,n,i,a,s){var c=o&&o(e,n,i,a,s);return!0!==c&&t["_"+r]({message:e,url:n,lineNumber:i,columnNumber:a,error:s}),c},e.autoExceptionInstrumented=!0}return t
      }({
          instrumentationKey:"728568e9-6aa0-4b28-9466-4ba46620ade0"
      });
    
    window[aiName]=aisdk,aisdk.queue&&0===aisdk.queue.length&&aisdk.trackPageView({});
  </script>


<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">Ricky Lin</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/HelpfulLinks" title="Helpful links gathered from the Internet.">
			  <i class="fa fa-link"></i>Helpful Links
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
    <div class="content">
      <div class="page-header page-header-inverse ">
  <h1 class="title title-inverse ">å­¦æ— æ­¢å¢ƒ</h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-heart"></i>
      ç†è§£å¾—è¶Šå¤šï¼Œéœ€è¦è®°å¿†çš„è¶Šå°‘
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
        <!-- render top articles firstly -->
        
        <!-- render other articles -->
        
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-13 </div>
			<div class="article-title"><a href="/2017/02/13/The-68-things-the-CLR-does-before-executing-a-single-line-of-your-code/" >The-68-things-the-CLR-does-before-executing-a-single-line-of-your-code</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>è™½ç„¶å·²ç»æ²¡ä»€ä¹ˆæ—¶é—´ç ”ç©¶è¿™ä¹ˆâ€œåº•å±‚â€çš„çŸ¥è¯†äº†ï¼Œä½†æ˜¯ä¾ç„¶è§‰å¾—éå¸¸å€¼å¾—å¤§ç•¥çœ‹ä¸€éå¹¶æ”¶è—ï¼š</p>
<p><a href="http://mattwarren.org/2017/02/07/The-68-things-the-CLR-does-before-executing-a-single-line-of-your-code/" target="_blank" rel="noopener">The 68 things the CLR does before executing a single line of your code</a></p>
<p>è¿™ç¯‡åšæ–‡æ‰€åœ¨çš„<a href="http://mattwarren.org" target="_blank" rel="noopener">åšå®¢</a>æœ‰å¾ˆå¤šéå¸¸æœ‰æ·±åº¦çš„å†…å®¹ï¼Œå€¼å¾—ç»å¸¸æ‹œè¯»ä¸€ä¸‹ã€‚</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
	
	</div>
  <a type="button" href="/2017/02/13/The-68-things-the-CLR-does-before-executing-a-single-line-of-your-code/#more" class="btn btn-default more">é˜…è¯»æ­¤æ–‡</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-13 </div>
			<div class="article-title"><a href="/2017/02/13/implicit-metapackage-package-reference-in-the-dotnet-core-sdk/" >Implicit metapackage package reference in the .NET Core SDK - Visual Studio 2017 RC3</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>ä»æ­¤é»˜è®¤ä¸éœ€è¦å†å¼•ç”¨ Microsoft.NETCore.App æˆ–è€… NetStandard.Library äº†ï¼š</p>
<p><a href="https://github.com/dotnet/core/blob/master/release-notes/1.0/sdk/1.0-rc3-implicit-package-refs.md" target="_blank" rel="noopener">Implicit metapackage package reference in the .NET Core SDK - Visual Studio 2017 RC3</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
	
	</div>
  <a type="button" href="/2017/02/13/implicit-metapackage-package-reference-in-the-dotnet-core-sdk/#more" class="btn btn-default more">é˜…è¯»æ­¤æ–‡</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-09 </div>
			<div class="article-title"><a href="/2017/02/09/uninstall-dotnet-core/" >åœ¨Mac OSé‡Œå¸è½½ dotnet core</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>éƒ½è¯´ Mac OS æ¯” Windows æ›´å®¹æ˜“å¸è½½è½¯ä»¶ï¼Œå…¶å®ï¼Œæˆ‘å¹¶ä¸è§‰å¾—ã€‚å°¤å…¶æ˜¯é‚£äº›é€šè¿‡ pkg æ–¹å¼å®‰è£…çš„è½¯ä»¶ã€‚ é‰´äº dotnet core sdk ä¹Ÿæ˜¯ç»å¸¸å‡çº§çš„ï¼Œæˆ‘å¹¶ä¸å¸Œæœ›åœ¨ Mac OS é‡Œç•™æœ‰2å¥— dotnet coreï¼Œäºæ˜¯å¦‚ä½•å¸è½½å°±æˆäº†ä¸€ä¸ªé—®é¢˜ã€‚å¥½åœ¨è¿™ä¸ªé—®é¢˜çš„è§£å†³æ¯”æƒ³è±¡ä¸­å®¹æ˜“ï¼Œå› ä¸ºæœ‰ç°æˆçš„<a href="https://github.com/dotnet/cli/blob/rel/1.0.0/scripts/obtain/uninstall/dotnet-uninstall-pkgs.sh" target="_blank" rel="noopener">å®˜æ–¹è„šæœ¬</a>å¯ä»¥ä½¿ç”¨ã€‚ä»æ­¤æˆ‘åº”è¯¥å¯ä»¥æ›´æ”¾å¿ƒå¤§èƒ†åœ°å½“å°ç™½é¼ äº†ã€‚</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
	
	</div>
  <a type="button" href="/2017/02/09/uninstall-dotnet-core/#more" class="btn btn-default more">é˜…è¯»æ­¤æ–‡</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-11-30 </div>
			<div class="article-title"><a href="/2016/11/30/console-app-and-di/" >Console app é‡Œçš„ä¾èµ–æ³¨å…¥åŠå…¶å®ä¾‹ç”Ÿå‘½å‘¨æœŸ</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>ä¾èµ–æ³¨å…¥æ˜¯ ASP.NET Core é‡Œçš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ï¼Œæˆ‘ä»¬å¹³å¸¸æ€»æ˜¯æ„‰å¿«åœ°åœ¨<code>Startup</code>ç±»çš„<code>ConfigureServices</code>æ–¹æ³•é‡Œå¾€<code>IServiceCollection</code>é‡Œæ³¨å†Œå„ç§ç±»å‹ï¼Œä»¥è‡´æœ‰ä¸€äº›åŒå­¦å¯èƒ½è¯¯ä»¥ä¸ºä¾èµ–æ³¨å…¥æ˜¯åªæœ‰ ASP.NET Core æ‰æœ‰çš„ç‰¹æ€§ã€‚ä½†å®é™…ä¸Šä¾èµ–æ³¨å…¥ä¹Ÿå¯ä»¥ç”¨äº .NET Core çš„ Console app. åˆ«å¿˜äº†ï¼Œ ASP.NET Core çš„åº”ç”¨æœ¬è´¨ä¸Šä¹Ÿåªæ˜¯ä¸€ä¸ª Console appè€Œå·²ã€‚ä»Šå¤©æˆ‘ä»¬åœ¨Console appé‡Œè¯•è¯•ä¾èµ–æ³¨å…¥ã€‚</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªConsole appï¼Œåœ¨å…¶ä¸­å¼•å…¥ä¾èµ–æ³¨å…¥ï¼Œæ³¨å†Œä¸åŒç”Ÿå‘½å‘¨æœŸçš„ç±»å‹ï¼Œç„¶ååˆ›å»ºå‡ ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ†åˆ«ä¾é ä¾èµ–æ³¨å…¥â€œåˆ›å»ºâ€è‹¥å¹²ç±»å‹å®ä¾‹ï¼Œç„¶åè§‚å¯Ÿä¸åŒç”Ÿå‘½å‘¨æœŸä¸‹è¿™äº›å®ä¾‹å˜é‡æ˜¯å¦æŒ‡å‘ä¸€ä¸ªå®ä¾‹è¿˜æ˜¯å„ä¸ç›¸åŒã€‚</p>
<h2 id="ServiceCollection"><a href="#ServiceCollection" class="headerlink" title="ServiceCollection"></a>ServiceCollection</h2><p>ç°åœ¨é—­ä¸Šçœ¼ç›æƒ³è±¡ä¸€ä¸‹ï¼ˆåˆ«ç¡ç€äº†ï¼‰ï¼Œæˆ‘ä»¬è‡ªå·±å°±æ˜¯ä¾èµ–æ³¨å…¥çš„æ‰§è¡Œè€…ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ¼‚äº®çš„ç¨‹åºåª›è·Ÿæˆ‘ä»¬è¯´å¥¹è¦æŸæŸç±»å‹çš„ä¸€ä¸ªå®ä¾‹ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšï¼Ÿæˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“è¿™æŸæŸç±»å‹æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ä»¥åŠå¦‚ä½•åˆ›å»ºå¯¹å§ï¼Ÿæˆ‘ä»¬å¦‚ä½•çŸ¥é“å‘¢ï¼Ÿå½“ç„¶æ˜¯å¥¹å¾—æå‰å‘Šè¯‰æˆ‘ä»¬å•Šï¼Œè€Œæˆ‘ä»¬è¦æœ‰ä¸ªåœ°æ–¹æŠŠè¿™äº›ä¿¡æ¯ä¿ç•™ä¸‹æ¥ç„¶ååœ¨éœ€è¦çš„æ—¶å€™å¯ä»¥æŸ¥é˜…ã€‚åœ¨ .NET Coreé‡Œï¼Œå¯ä»¥ä¾èµ–æ³¨å…¥çš„ç±»å‹å«<code>Service</code>ï¼Œè€Œè®°å½•è¿™äº›<code>Service</code>ä¿¡æ¯çš„è¿™åœ°æ–¹å°±æ˜¯<code>ServiceCollection</code>ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“ç¨‹åºè¿è¡Œèµ·æ¥ä¹‹åï¼Œæˆ‘ä»¬ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯åˆ›å»ºä¸€ä¸ª<code>ServiceCollection</code>ï¼Œæ€ä¹ˆåˆ›å»ºå‘¢ï¼Ÿ <code>new</code> å‘—</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// using Microsoft.Extensions.DependencyInjection</span></span><br><span class="line">ServiceCollection services = <span class="keyword">new</span> ServiceCollection();</span><br></pre></td></tr></tbody></table></figure>

<p>å¬èµ·æ¥é«˜å¤§ä¸Šçš„<code>ServiceCollection</code>ï¼Œå…¶åˆ›å»ºç«Ÿç„¶å¦‚æ­¤ç®€å•ã€‚<span class="github-emoji" style="display:inline;color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f613.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f613.png?v8">ğŸ˜“</span></p>
<h2 id="IServiceProvider"><a href="#IServiceProvider" class="headerlink" title="IServiceProvider"></a>IServiceProvider</h2><p>çœ‹ç€ <code>ServiceCollection</code>é‡Œçœ¼èŠ±ç¼­ä¹±çš„å„ç§ç±»å‹ï¼Œæˆ‘ä»¬å¿ƒä¸­å……æ»¡è‡ªä¿¡ï¼Œâ€œå¦¹å­ï¼Œè¯´å§ï¼Œä½ æƒ³è¦å“ªä¸ªç±»å‹çš„å®ä¾‹ï¼Ÿâ€ï¼Œå¦¹å­ä¸€è„¸ä¸ä¹æ„â€œè¦ä½ ä¸ªå¤´ï¼Œæˆ‘ä¸¤æ‰‹ç©ºç©ºæ‹¿ä»€ä¹ˆå»å–ç±»å‹çš„å®ä¾‹ï¼Ÿâ€â€¦â€¦å¯¹å•Šï¼Œæˆ‘ä»¬æ€»å¾—ç»™äººå®¶ä¸€ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œç„¶åäººå®¶å¯ä»¥ç”¨å®ƒä»<code>ServiceCollection</code>é‡Œè·å–å®ä¾‹å•Šã€‚ã€‚ã€‚è¿™ä¸œè¥¿å°±æ˜¯<code>IServiceProvider</code>ï¼Œæˆ‘ä»¬çš„<code>ServiceCollection</code>å¯ä»¥ç”Ÿæˆä¸€ä¸ª<code>IServiceProvider</code>ï¼Œè€Œä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œåªè¦æœ‰è¿™ä¸ª<code>IServiceProvider</code>å°±å¯ä»¥ä»æˆ‘ä»¬çš„<code>ServiceCollection</code>é‡Œè·å–å®ä¾‹ã€‚</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ServiceCollection services = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘servicesæ³¨å†Œå„ç§ç±»å‹</span></span><br><span class="line"></span><br><span class="line">IServiceProvider sp = services.BuildServiceProvider();</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»æ­¤ä»¥åï¼Œä»»ä½•æ¡æœ‰ sp çš„å¯¹è±¡å¯ä»¥ä»ServiceCollectioné‡Œè·å–å®ä¾‹ã€‚</span></span><br></pre></td></tr></tbody></table></figure>

<p>æœ‰è¶£çš„æ˜¯ï¼Œ <code>IServiceProvider</code>æ˜¯<code>System</code>å‘½åç©ºé—´ä¸‹çš„ã€‚</p>
<h2 id="Serviceçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Serviceçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Serviceçš„ç”Ÿå‘½å‘¨æœŸ"></a>Serviceçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>è‡ªè„±ç¦» ASP.NET Web Form çš„ä¸–ç•Œä»¥æ¥ï¼Œå·²ç»å¾ˆå°‘å¬åˆ°ã€çœ‹åˆ°â€œç”Ÿå‘½å‘¨æœŸâ€è¿™ä¸ªè¯äº†ã€‚é¥æƒ³å½“å¹´æ— è®ºæ˜¯é¢è¯•è¿˜æ˜¯è¢«é¢è¯•ï¼Œâ€œASP.NET é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸâ€é‚£ç®€ç›´æ˜¯å¿…å¤‡é—®é¢˜ â€”â€” è·‘é¢˜äº†ã€‚</p>
<p>è¿˜æ˜¯é—­ä¸Šçœ¼ç›ï¼ˆè¿˜æ˜¯åˆ«ç¡ç€äº†ï¼‰ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œè¿˜æ˜¯é‚£ä¸ªæ¼‚äº®çš„ç¨‹åºåª›ï¼Œå¥¹ç•¥å¸¦å¨‡å—”åœ°å¯¹æˆ‘ä»¬è¯´ï¼šâ€œå¥½å“¥å“¥ï¼Œå¸®æˆ‘æŠŠè¿™ä¸ªæŸæŸç±»å‹æ³¨å†Œåˆ°ä¾èµ–æ³¨å…¥é‡Œå§ï¼Œå¯ä»¥å—ï¼Ÿâ€ï¼Œæ—¢ç„¶æˆ‘ä»¬ç°åœ¨æœ‰äº†<code>ServiceCollection</code>ï¼Œæ³¨å†Œå½“ç„¶ä¸æˆé—®é¢˜ï½ï¼Œä½†å†ä»”ç»†æƒ³æƒ³ï¼Œå½“æˆ‘ä»¬æŠŠæŸæŸç±»å‹æ·»åŠ åˆ°<code>ServiceCollection</code>ï¼Œç»§è€Œåˆ›å»ºå‡ºä¸€ä¸ª<code>IServiceProvider</code>ç»™ç¨‹åºåª›å¦¹å­ï¼Œæ¥ç€ç¨‹åºåª›å¦¹å­ä¸åœåœ°ä»<code>ServiceCollection</code>é‡Œè·å–å®ä¾‹æ—¶ï¼Œå¥¹å¾—åˆ°çš„æ˜¯åŒä¸€ä¸ªå®ä¾‹å‘¢è¿˜æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½ç»™å¥¹ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Ÿè°çŸ¥é“ï¼Œå¾—é—®å¥¹æ‰çŸ¥é“ã€‚æ‰€ä»¥å¹³å¸¸ä¸æ“…è¨€è¾ã€ä»ä¸åºŸè¯çš„æˆ‘ä»¬ä¸èƒ½æµªè´¹è¿™æ¬¡äº¤æµçš„æœºä¼šï¼Œåœ¨ç¨‹åºåª›å¦¹å­è®©æˆ‘ä»¬æ³¨å†Œç±»å‹çš„æ—¶å€™æˆ‘ä»¬è¿˜è¦é—®æ¸…æ¥šå¥¹æƒ³æ€æ ·å¾—åˆ°è¿™ä¸ªç±»å‹çš„å®ä¾‹ï¼Œæ¯æ¬¡éƒ½ç»™å¥¹ä¸€ä¸ªæ–°çš„ï¼Œè¿˜æ˜¯æ€»ç»™å¥¹åŒä¸€ä¸ªï¼Ÿæ¢å¥è¯è¯´ï¼Œå½“ä¸€ä¸ª<code>Service</code>è¢«æ³¨å†Œåˆ°<code>ServiceCollection</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶çŸ¥é“å®ƒçš„ç±»å‹å’Œå®ä¾‹ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p><code>ServiceCollection</code>å¾ˆä½“è´´ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ä¸åŒçš„æ³¨å†Œæ–¹æ³•æ³¨å†Œä¸åŒç”Ÿå‘½å‘¨æœŸçš„<code>Service</code>ï¼š</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AddTransient æ–¹æ³•å°†ä¸€ä¸ªç±»å‹æ³¨å†Œä¸º Transient ç”Ÿå‘½å‘¨æœŸã€‚å› æ­¤ï¼Œæ¯ä¸€æ¬¡ä½ ä»ä¾èµ–æ³¨å…¥ä¸­è¯·æ±‚ä¸€ä¸ª MyTransientClass å®ä¾‹ï¼Œä½ éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªå…¨æ–°å®ä¾‹åŒ–çš„å®ä¾‹ã€‚è¯·æ±‚10æ¬¡ï¼Œå°±å¾—åˆ°10ä¸ªä¸åŒçš„å®ä¾‹ã€‚</span></span><br><span class="line">service.AddTransient&lt;MyTransientClass&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// AddSingleton æ–¹æ³•å°†ä¸€ä¸ªç±»å‹æ³¨å†Œä¸º Singleton ç”Ÿå‘½å‘¨æœŸã€‚å•ä½“å¤§å®¶éƒ½æ‡‚ï¼Œå°±æ˜¯æ— è®ºè¯·æ±‚å¤šå°‘æ¬¡ï¼Œä½ ä»ä¾èµ–æ³¨å…¥éƒ½ä¼šå¾—åˆ°åŒä¸€ä¸ª MySingletonClass å®ä¾‹ã€‚è¯·æ±‚10æ¬¡ï¼Œå¾—åˆ°çš„å´æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</span></span><br><span class="line">service.AddSingleton&lt;MySingletonClass&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// AddScoped æ–¹æ³•å°†ä¸€ä¸ªç±»å‹æ³¨å†Œä¸º Scoped ç”Ÿå‘½å‘¨æœŸã€‚è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒç‰¹åˆ«ã€‚å¦‚æœä½ çš„ç¨‹åºé‡Œåˆ›å»ºäº†è‹¥å¹²ä¸ª "Scope"ï¼Œä¾èµ–æ³¨å…¥ä¼šç¡®ä¿åœ¨åŒä¸€ä¸ª Scope é‡Œï¼Œä½ å°†å¾—åˆ°åŒä¸€ä¸ª MyScopedClass å®ä¾‹ï¼Œè€Œä¸åŒ Scope é‡Œçš„ MyScopedClass å®ä¾‹æ˜¯ä¸åŒçš„</span></span><br><span class="line"><span class="comment">// å‡è®¾ä½ æœ‰3ä¸ªScopeï¼Œæ¯ä¸ªScopeé‡Œè¯·æ±‚10æ¬¡ï¼Œé‚£ä¹ˆä½ å°†å¾—åˆ°3ä¸ªä¸åŒçš„ MyScopedClass å®ä¾‹ã€‚å…¶ä¸­æ¯ä¸ª Scope é‡Œä¸€ä¸ªã€‚</span></span><br><span class="line"><span class="comment">// è‡³äº Scope åˆ°åº•æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Œè¿™å°±å› ç¨‹åºè€Œå¼‚äº†ã€‚æ¯”å¦‚åœ¨ ASP.NET Core é‡Œï¼Œä¸€ä¸ªScopeæ„å‘³ç€ä¸€æ¬¡æµè§ˆå™¨è¯·æ±‚å¾€è¿”ã€‚è€Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºé‡Œï¼Œä¸€ä¸ªScopeä»£è¡¨ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨ã€‚</span></span><br><span class="line">service.AddScoped&lt;MyScopedClass&gt;();</span><br></pre></td></tr></tbody></table></figure>

<p>ä»¥ä¸Š3ä¸ªç”Ÿå‘½å‘¨æœŸç±»å‹åŸºæœ¬ä¸Šæ¶µç›–äº†æ‰€æœ‰å¯èƒ½çš„åœºæ™¯ï¼š</p>
<ol>
<li>æ¯æ¬¡éƒ½è¦æ–°å®ä¾‹ã€‚</li>
<li>æ°¸è¿œéƒ½åªéœ€è¦åŒä¸€ä¸ªå®ä¾‹ã€‚</li>
<li>åœ¨ä¸€ä¸ªèŒƒå›´ä¹‹å†…åªéœ€è¦åŒä¸€ä¸ªå®ä¾‹ï¼Œä½†æ˜¯ä¸åŒèŒƒå›´ä¹‹å†…çš„å®ä¾‹è¦ä¸åŒã€‚</li>
</ol>
<h2 id="é†’é†’ï¼Œæ— èŠçš„ç†è®ºæ—¶é—´è¿‡å»äº†ï¼ŒDemo-ä¸Šåœºäº†"><a href="#é†’é†’ï¼Œæ— èŠçš„ç†è®ºæ—¶é—´è¿‡å»äº†ï¼ŒDemo-ä¸Šåœºäº†" class="headerlink" title="é†’é†’ï¼Œæ— èŠçš„ç†è®ºæ—¶é—´è¿‡å»äº†ï¼ŒDemo ä¸Šåœºäº†"></a>é†’é†’ï¼Œæ— èŠçš„ç†è®ºæ—¶é—´è¿‡å»äº†ï¼ŒDemo ä¸Šåœºäº†</h2><p>è¯´ä¹¦è€…æ›°â€œé—²è¯ä¼‘æï¼Œä¸”è¯´æ­£è¯â€ï¼Œå’±ä»¬ä¹Ÿåˆ°äº†â€œç†è®ºä¼‘æï¼Œä¸”çœ‹Demoâ€çš„æ—¶å€™äº†ã€‚ .NET Core çš„ä¸€å¤§ä¼˜ç‚¹æ˜¯å‘½ä»¤è¡Œå‹å¥½ï¼Œå¹¶ä¸”ä¸ç”¨ç‰¹åˆ«ä¾é åŠŸèƒ½å¼ºå¤§ä½†è‡ƒè‚¿çš„ Visual Studioæ¥å¼€å‘ã€‚æˆ‘çš„Demoæ˜¯åœ¨ MacOS + .NET Core CLI (v1.1) + Visual Studio Code ç¯å¢ƒä¸‹åˆ›å»ºå’Œè¿è¡Œçš„ã€‚è¿™å¥—ç¯å¢ƒåœ¨å…¶å®ƒå¹³å°ä¸‹çš„ä½“éªŒå‡ ä¹æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<p>é¦–å…ˆæ‰“å¼€ä¸€ä¸ªå‘½ä»¤è¡Œï¼Œåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç„¶ååœ¨æ–°åˆ›å»ºçš„ç›®å½•é‡Œæ‰§è¡Œ <code>dotnet new</code>å‘½ä»¤ã€‚è¿™å°†åˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„ Console App.</p>
<p><img src="create_console_app.png" alt="create console app"></p>
<p>æ³¨æ„ï¼Œåˆ©ç”¨ <code>dotnet new</code> åˆ›å»ºçš„æ–‡ä»¶ç«Ÿç„¶åŠ äº†å¯æ‰§è¡Œå±æ€§ï¼ˆæ‰€ä»¥æ˜¾ç¤ºä¸ºçº¢è‰²ï¼‰ï¼Œè¿™åº”è¯¥æ˜¯ä¸ªbugï¼Œå¹¶ä¸”ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬é‡Œä¿®å¤ã€‚æœ€åè¿è¡Œ <code>code .</code>ä¼šæŠŠå½“å‰ç›®å½•åœ¨ Visual Studio Code é‡Œæ‰“å¼€ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å†™ä»£ç äº†ã€‚</p>
<h2 id="STEP-1-æ·»åŠ å¯¹-Microsoft-Extensions-DependencyInjection-çš„å¼•ç”¨"><a href="#STEP-1-æ·»åŠ å¯¹-Microsoft-Extensions-DependencyInjection-çš„å¼•ç”¨" class="headerlink" title="STEP 1: æ·»åŠ å¯¹ Microsoft.Extensions.DependencyInjection çš„å¼•ç”¨"></a>STEP 1: æ·»åŠ å¯¹ Microsoft.Extensions.DependencyInjection çš„å¼•ç”¨</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªå¼•ç”¨ï¼š<code>Microsoft.Extensions.DependencyInjection</code>ï¼Œä¾èµ–æ³¨å…¥çš„é»˜è®¤å®ç°éƒ½åœ¨é‡Œé¢ã€‚</p>
<p>æ‰“å¼€ <code>project.json</code>ï¼Œç„¶ååœ¨<code>dependencies</code>é‡Œæ·»åŠ å¼•ç”¨ã€‚æ·»åŠ å®Œæˆä¹‹åï¼Œ<code>project.json</code>åº”è¯¥çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0-*"</span>,</span><br><span class="line">  <span class="attr">"buildOptions"</span>: {</span><br><span class="line">    <span class="attr">"debugType"</span>: <span class="string">"portable"</span>,</span><br><span class="line">    <span class="attr">"emitEntryPoint"</span>: <span class="literal">true</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"dependencies"</span>: {</span><br><span class="line">    <span class="attr">"Microsoft.Extensions.DependencyInjection"</span>: <span class="string">"1.1.0"</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"frameworks"</span>: {</span><br><span class="line">    <span class="attr">"netcoreapp1.1"</span>: {</span><br><span class="line">      <span class="attr">"dependencies"</span>: {</span><br><span class="line">        <span class="attr">"Microsoft.NETCore.App"</span>: {</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"platform"</span>,</span><br><span class="line">          <span class="attr">"version"</span>: <span class="string">"1.1.0"</span></span><br><span class="line">        }</span><br><span class="line">      },</span><br><span class="line">      <span class="attr">"imports"</span>: <span class="string">"dnxcore50"</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ·»åŠ å¥½å¼•ç”¨ä¹‹åï¼Œä¿å­˜ï¼Œè¿™æ—¶ VS Codeçš„é¡¶éƒ¨åº”è¯¥ä¼šæœ‰ä¸ªæç¤ºï¼Œè¯´â€There are unresolved dependencies from â€˜project.jsonâ€™. Please execute the restore command to continue.â€ï¼Œä½ å¯ä»¥ç›´æ¥ç‚¹â€œRestoreâ€æŒ‰é’®æˆ–è€…æ‰‹å·¥åœ¨å‘½ä»¤è¡Œé‡Œè¿è¡Œ <code>dotnet restore</code>å‘½ä»¤æ¥è¿˜åŸä¾èµ–ã€‚</p>
<p>å¦‚æœä½ è§‚å¯Ÿæ–°åˆ›å»ºçš„ ASP.NET Core ç¨‹åºçš„ project.json æ–‡ä»¶ï¼Œä½ å¯èƒ½ä¼šå‘ç°ä¾èµ–åˆ—è¡¨é‡Œå¹¶æ²¡æœ‰<code>Microsoft.Extensions.DependencyInjection</code>ï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è¿™é‡Œéœ€è¦æ·»åŠ è¿™ä¸ªå¼•ç”¨å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä½ çš„ project.json æ–‡ä»¶é‡Œæœ‰ ASP.NET Core çš„å¼•ç”¨ï¼Œæ¯”å¦‚ <code>Microsoft.AspNetCore.Mvc</code>ï¼Œè€Œå®ƒæˆ–è€…å®ƒä¾èµ–çš„å¼•ç”¨é‡Œæœ‰å¯¹<code>Microsoft.Extensions.DependencyInjection</code>çš„å¼•ç”¨ã€‚å› æ­¤ä½ çš„ ASP.NET Coreç¨‹åºå…¶å®æ˜¯é—´æ¥çš„å¼•ç”¨äº†<code>Microsoft.Extensions.DependencyInjection</code>ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºé‡Œâ€œå¹²å‡€â€å¾—å¾ˆï¼Œæ‰€ä»¥å¿…é¡»ç›´æ¥æ·»åŠ å¯¹<code>Microsoft.Extensions.DependencyInjection</code>çš„å¼•ç”¨ã€‚</p>
<p><em>æ³¨æ„ï¼Œæˆ‘æ˜¯ä½¿ç”¨ 1.1 ç‰ˆæœ¬çš„ .NET Coreï¼Œæ‰€ä»¥å¼•ç”¨çš„ç‰ˆæœ¬å·éƒ½æ˜¯â€œ1.1.0â€ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯1.0.0æˆ–1.0.1ç‰ˆæœ¬çš„ .NET Coreï¼Œé‚£ä¹ˆè¿™é‡Œçš„ç‰ˆæœ¬å·ä¼šæœ‰æ‰€ä¸åŒã€‚</em></p>
<h2 id="STEP2ï¼š-å‡†å¤‡å·¥ä½œ"><a href="#STEP2ï¼š-å‡†å¤‡å·¥ä½œ" class="headerlink" title="STEP2ï¼š å‡†å¤‡å·¥ä½œ"></a>STEP2ï¼š å‡†å¤‡å·¥ä½œ</h2><p>åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºå¼•å…¥ä¾èµ–æ³¨å…¥ä¹‹å‰ï¼Œæœ‰å‡ é¡¹å‡†å¤‡å·¥ä½œè¦åšã€‚</p>
<p><strong>é¦–å…ˆï¼Œ</strong> æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯ä»¥æ³¨å†Œåˆ°ä¾èµ–æ³¨å…¥çš„ç±»å‹ï¼Œè¿™ä¸ªç®€å•ï¼š</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyClass</span> { }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å…¶æ¬¡ï¼Œ</strong> æˆ‘ä»¬éœ€è¦æŸç§æ–¹æ³•æ¥æ£€æµ‹ä»ä¾èµ–æ³¨å…¥ä¸­å¾—åˆ°çš„ç±»å‹å®ä¾‹æ˜¯ç›¸åŒçš„è¿˜æ˜¯ä¸åŒçš„ã€‚ä»€ä¹ˆå«ç›¸åŒï¼Ÿå°±æ˜¯è¿™äº›å®ä¾‹éƒ½æŒ‡å‘å†…å­˜é‡Œçš„åŒä¸€ä¸ªå¯¹è±¡ã€‚å¯¹æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>Object</code>ç±»å‹çš„é™æ€æ–¹æ³•<code>ReferenceEquals</code>æ¥æ£€æµ‹ã€‚é¡¾åæ€ä¹‰ï¼Œæ— éœ€è§£é‡Šã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•æœ¬èº«åªèƒ½é’ˆå¯¹2ä¸ªå®ä¾‹è¿›è¡Œæ£€æµ‹ï¼Œæˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºæƒ³ä¸€æ¬¡å¾—åˆ°10ä¸ªå®ä¾‹å¼•ç”¨ï¼Œæ€ä¹ˆæ£€æµ‹è¿™10ä¸ªå®ä¾‹å¼•ç”¨æ˜¯ç›¸åŒè¿˜æ˜¯ä¸åŒï¼Ÿè®°å¾—å†™SQLè¯­å¥çš„æ—¶å€™ï¼Œæœ‰ä¸ªå…³é”®å­—å«<code>Distinct</code>ï¼Œå®ƒå¯ä»¥å‰”é™¤é›†åˆä¸­çš„é‡å¤é¡¹ã€‚è€Œæˆ‘ä»¬å¼•ä»¥ä¸ºå‚²çš„LINQåŒæ ·æ”¯æŒ<code>Distinct</code>ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰å®ä¾‹æ”¾åˆ°ä¸€ä¸ªé›†åˆï¼Œç„¶åå¯¹é›†åˆè¿›è¡Œ<code>Distinct</code>æ“ä½œï¼Œå¦‚æœç»“æœæ˜¯<code>1</code>ï¼Œè¯´æ˜é›†åˆé‡Œæ‰€æœ‰çš„å®ä¾‹å…¶å®æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼›å¦‚æœç»“æœç­‰äºé›†åˆåŸæœ¬çš„å…ƒç´ ä¸ªæ•°ï¼Œé‚£è¯´æ˜é›†åˆé‡Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æ˜¯äº’ä¸ç›¸åŒçš„ã€‚</p>
<p>é‰´äºæˆ‘ä»¬ä½¿ç”¨å¤šä¸ªçº¿ç¨‹å‘é›†åˆé‡Œæ’å…¥æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¤šçº¿ç¨‹å®‰å…¨çš„é›†åˆç±»å‹ï¼š<code>System.Collections.Concurrent.ConcurrentBag&lt;T&gt;</code>ã€‚</p>
<p>è€Œè°ƒç”¨<code>Distinct</code>æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒå¯ä»¥æ˜ç¡®åœ°ä»¥<code>ReferenceEquals</code>çš„æ–¹å¼æ¯”è¾ƒï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªå®ç°<code>IEqualityComparer&lt;T&gt;</code>æ¥å£çš„ç±»<code>ReferenceEqualComparer&lt;T&gt;</code>æ¥åšåˆ°ã€‚</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class ReferenceEqualComparer&lt;T&gt; : IEqualityComparer&lt;T&gt;</span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">Equals</span>(<span class="params">T x, T y</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">return</span> Object.ReferenceEquals(x, y);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetHashCode</span>(<span class="params">T obj</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">return</span> obj.GetHashCode();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>ç„¶åï¼Œ</strong> æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ª<code>IEnumerable&lt;T&gt;</code>ä¸Šçš„æ‰©å±•æ–¹æ³•æ¥ç®€åŒ–æ¯”è¾ƒæ“ä½œã€‚</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">IEnumerableExtensions</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> AreIdentical&lt;T&gt;(<span class="keyword">this</span> IEnumerable&lt;T&gt; bag)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> bag.Distinct(<span class="keyword">new</span> ReferenceEqualComparer&lt;T&gt;()).Count() == <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> AreDifferent&lt;T&gt;(<span class="keyword">this</span> IEnumerable&lt;T&gt; bag)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> bag.Distinct(<span class="keyword">new</span> ReferenceEqualComparer&lt;T&gt;()).Count() == bag.Count();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æœ€åï¼Œ</strong> æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥ä¼ å…¥ä¸€ä¸ª<code>ServiceCollection</code>å¯¹è±¡ï¼Œç„¶åæˆ‘ä»¬ä»ä¸­è·å–<code>IServiceProvider</code>ï¼Œå†åˆ›å»º10ä¸ªçº¿ç¨‹åˆ†åˆ«åˆ©ç”¨<code>IServiceProvider</code>è·å–æœåŠ¡å®ä¾‹ï¼Œæ’å…¥åˆ°ä¸€ä¸ªé›†åˆä¸­å¹¶è¿”å›è¿™ä¸ªé›†åˆã€‚</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConcurrentBag&lt;MyClass&gt; <span class="title">GetObjectsFromDI</span>(<span class="params">ServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">int</span> threadCount = <span class="number">10</span>;</span><br><span class="line">    IServiceProvider sp = services.BuildServiceProvider();</span><br><span class="line">    ConcurrentBag&lt;MyClass&gt; bag = <span class="keyword">new</span> ConcurrentBag&lt;MyClass&gt;();</span><br><span class="line">    Thread[] threads = <span class="keyword">new</span> Thread[threadCount];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; threadCount; i++)</span><br><span class="line">    {</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(RunPerThread);</span><br><span class="line">        threads[i] = thread;</span><br><span class="line">        thread.Start(<span class="keyword">new</span> Tuple&lt;IServiceProvider, ConcurrentBag&lt;MyClass&gt;&gt;(sp, bag));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¡®ä¿æ‰€æœ‰çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åå†ç»§ç»­</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; threadCount; i++)</span><br><span class="line">    {</span><br><span class="line">        threads[i].Join();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bag;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RunPerThread</span>(<span class="params"><span class="keyword">object</span> threadParam</span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Tuple&lt;IServiceProvider, ConcurrentBag&lt;MyClass&gt;&gt; args = threadParam <span class="keyword">as</span> Tuple&lt;IServiceProvider, ConcurrentBag&lt;MyClass&gt;&gt;;</span><br><span class="line">    IServiceProvider sp = args.Item1;</span><br><span class="line">    ConcurrentBag&lt;MyClass&gt; bag = args.Item2;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    {</span><br><span class="line">        bag.Add(sp.GetRequiredService&lt;MyClass&gt;());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä»¥ä¸Šçš„å‡†å¤‡å·¥ä½œä½¿æˆ‘ä»¬æ¥ä¸‹æ¥çš„éªŒè¯æ“ä½œå˜å¾—å®¹æ˜“äº†å¾ˆå¤šã€‚</p>
<h2 id="STEP-3-éªŒè¯-Singleton-ç”Ÿå‘½å‘¨æœŸ"><a href="#STEP-3-éªŒè¯-Singleton-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="STEP 3: éªŒè¯ Singleton ç”Ÿå‘½å‘¨æœŸ"></a>STEP 3: éªŒè¯ Singleton ç”Ÿå‘½å‘¨æœŸ</h2><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–¹æ³•<code>TryOutSingleton</code>æ¥éªŒè¯ Singleton ç”Ÿå‘½å‘¨æœŸ</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TryOutSingleton</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    ServiceCollection services = <span class="keyword">new</span> ServiceCollection(); <span class="comment">// å‡†å¤‡å¥½æˆ‘ä»¬çš„å®¹å™¨</span></span><br><span class="line">    services.AddSingleton&lt;MyClass&gt;(); <span class="comment">//æŠŠMyClassæ³¨å†Œä¸º Singleton ç”Ÿå‘½å‘¨æœŸ </span></span><br><span class="line"></span><br><span class="line">    ConcurrentBag&lt;MyClass&gt; bag = GetObjectsFromDI(services); <span class="comment">// è°ƒç”¨æˆ‘ä»¬å‡†å¤‡å¥½çš„æ–¹æ³•ï¼Œç”¨è‹¥å¹²çº¿ç¨‹ä» IServiceProvider ä¸­è·å– MyClass å®ä¾‹ï¼Œå¹¶åŠ å…¥åˆ°é›†åˆ</span></span><br><span class="line"></span><br><span class="line">    Console.WriteLine(bag.AreIdentical()); <span class="comment">// éªŒè¯é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡ã€‚</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸å‡ºæ‰€æ–™ï¼Œæœ€åè¾“å‡ºçš„ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></tbody></table></figure>

<h2 id="STEP-4-éªŒè¯-Transient-ç”Ÿå‘½å‘¨æœŸ"><a href="#STEP-4-éªŒè¯-Transient-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="STEP 4: éªŒè¯ Transient ç”Ÿå‘½å‘¨æœŸ"></a>STEP 4: éªŒè¯ Transient ç”Ÿå‘½å‘¨æœŸ</h2><p>å†åˆ›å»ºä¸€ä¸ª <code>TryOutTransient</code> æ–¹æ³•éªŒè¯ Transient ç”Ÿå‘½å‘¨æœŸ</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TryOutTransient</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    ServiceCollection services = <span class="keyword">new</span> ServiceCollection(); <span class="comment">// å‡†å¤‡å¥½æˆ‘ä»¬çš„å®¹å™¨</span></span><br><span class="line">    services.AddTransient&lt;MyClass&gt;(); <span class="comment">//æŠŠMyClassæ³¨å†Œä¸º Transient ç”Ÿå‘½å‘¨æœŸ </span></span><br><span class="line"></span><br><span class="line">    ConcurrentBag&lt;MyClass&gt; bag = GetObjectsFromDI(services); <span class="comment">// è°ƒç”¨æˆ‘ä»¬å‡†å¤‡å¥½çš„æ–¹æ³•ï¼Œç”¨è‹¥å¹²çº¿ç¨‹ä» IServiceProvider ä¸­è·å– MyClass å®ä¾‹ï¼Œå¹¶åŠ å…¥åˆ°é›†åˆ</span></span><br><span class="line">    </span><br><span class="line">    Console.WriteLine(bag.AreDifferent()); <span class="comment">// éªŒè¯é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦å„ä¸ç›¸åŒ</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åŒæ ·ä¸å‡ºæ„å¤–ï¼Œè¾“å‡ºç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></tbody></table></figure>

<h2 id="STEP-5-Scoped-ç”Ÿå‘½å‘¨æœŸ"><a href="#STEP-5-Scoped-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="STEP 5: Scoped ç”Ÿå‘½å‘¨æœŸ"></a>STEP 5: Scoped ç”Ÿå‘½å‘¨æœŸ</h2><p>å‰é¢æåˆ°è¿‡ï¼Œ Scoped ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒç‰¹åˆ«ï¼ŒåŒä¸€ä¸ªScopeé‡Œçš„å®ä¾‹æ˜¯åŒä¸€ä¸ªï¼Œä½†æ˜¯ä¸åŒScopeé‡Œçš„å®ä¾‹æ˜¯ä¸åŒçš„ã€‚è€ŒScopeå…·ä½“çš„å«ä¹‰å–å†³äºæˆ‘ä»¬è‡ªå·±çš„å®šä¹‰ã€‚</p>
<p>å…·ä½“åˆ°ä»£ç çº§åˆ«ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªScopeçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰å¾—åˆ°çš„<code>IServiceProvider</code>ï¼Œå®ƒæœ‰ä¸€ä¸ª<code>CreateScope</code>æ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»å‹ä¸º<code>Microsoft.Extensions.DependencyInjection.IServiceScope</code>çš„Scopeï¼Œè€Œè¿™ä¸ªScopeå®ä¾‹æœ‰ä¸€ä¸ª<code>IServiceProvider</code>ç±»å‹çš„å±æ€§<code>ServiceProvider</code>ï¼è‡ªæ­¤ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨è¿™ä¸ªæ¥è‡ª<code>IServiceScope</code>çš„<code>IServiceProvider</code>ï¼ˆå–ä»£ä¹‹å‰æˆ‘ä»¬å¾—åˆ°çš„<code>IServiceProvider</code>ï¼‰æ¥è·å–æœåŠ¡å®ä¾‹ï¼Œå®ƒä¼šæ­£ç¡®å¤„ç†Singleton, Transientä»¥åŠScopedè¿™3ç§ç”Ÿå‘½å‘¨æœŸ!</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ServiceCollection services = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">IServiceProvider serviceProvider = services.BuildServiceProvider();</span><br><span class="line"></span><br><span class="line">IServiceScope scope = serviceProvider.CreateScope();</span><br><span class="line"></span><br><span class="line">IServiceProvider newServiceProvider = scope.ServiceProvider; <span class="comment">// ä»¥åé å®ƒæ¥æ­£ç¡®å¤„ç† Singleton, Transient å’Œ Scoped ç”Ÿå‘½å‘¨æœŸçš„å®ä¾‹</span></span><br><span class="line"></span><br><span class="line">MyClass obj = newServiceProvider.GetRequiredService&lt;MyClass&gt;(); <span class="comment">// æ— è®ºMyClassæ˜¯å“ªç§ç”Ÿå‘½å‘¨æœŸç±»å‹ï¼Œè¿™é‡Œéƒ½å¯ä»¥å¾—åˆ°æ­£ç¡®çš„å®ä¾‹ã€‚</span></span><br></pre></td></tr></tbody></table></figure>

<p>ä¸ºäº†éªŒè¯Scopedç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬ç°åœ¨å®šä¹‰Scopeä¸ºçº¿ç¨‹ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹ä¸ºä¸€ä¸ªScopeï¼Œå¯¹äºScopedç”Ÿå‘½å‘¨æœŸçš„ç±»å‹ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¹‹å†…è·å–çš„å®ä¾‹åº”è¯¥æ˜¯åŒä¸€ä¸ªï¼Œä½†æ˜¯ä¸åŒçº¿ç¨‹è·å–çš„å®ä¾‹æ˜¯ä¸åŒçš„ã€‚</p>
<p>åœ¨æ¼”ç¤ºä»£ç ä¸­ï¼Œæˆ‘ä»¬æ³¨å†Œ3ä¸ªä¸åŒçš„ç±»å‹ï¼Œåˆ†åˆ«å¯¹åº”3ç§ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œçœ‹çœ‹æ¥è‡ª<code>IServiceScope</code>çš„<code>IServiceProvider</code>èƒ½å¦æ­£ç¡®å¤„ç†æ¯ä¸€ç§ç”Ÿå‘½å‘¨æœŸç±»å‹ã€‚</p>
<p>ä»£ç æœ‰äº›å•°å—¦ï¼Œå› ä¸ºä¸æƒ³å†æ‹†åˆ†æˆæ›´å°çš„æ–¹æ³•äº†ï¼š</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">public class MySingleton { }</span></span><br><span class="line"><span class="comment">public class MyTransient { }</span></span><br><span class="line"><span class="comment">public class MyScoped { }</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TryOutScoped</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Console.WriteLine(<span class="string">$"RUNNING <span class="subst">{<span class="keyword">nameof</span>(TryOutScoped)}</span>"</span>);</span><br><span class="line"></span><br><span class="line">    ServiceCollection services = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line">    services.AddSingleton&lt;MySingleton&gt;();</span><br><span class="line">    services.AddTransient&lt;MyTransient&gt;();</span><br><span class="line">    services.AddScoped&lt;MyScoped&gt;();</span><br><span class="line"></span><br><span class="line">    IServiceProvider sp = services.BuildServiceProvider();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿ç¨‹1æ‰§è¡Œ</span></span><br><span class="line">    ConcurrentBag&lt;MySingleton&gt; thread1SingletonBag = <span class="keyword">new</span> ConcurrentBag&lt;MySingleton&gt;();</span><br><span class="line">    ConcurrentBag&lt;MyTransient&gt; thread1TransientBag = <span class="keyword">new</span> ConcurrentBag&lt;MyTransient&gt;();</span><br><span class="line">    ConcurrentBag&lt;MyScoped&gt; thread1ScopedBag = <span class="keyword">new</span> ConcurrentBag&lt;MyScoped&gt;();</span><br><span class="line"></span><br><span class="line">    Thread thread1 = <span class="keyword">new</span> Thread(RunPerThreadWithScopedLifetime);</span><br><span class="line">    thread1.Start(<span class="keyword">new</span> Tuple&lt;IServiceProvider, ConcurrentBag&lt;MySingleton&gt;, ConcurrentBag&lt;MyTransient&gt;, ConcurrentBag&lt;MyScoped&gt;&gt;(sp, thread1SingletonBag, thread1TransientBag, thread1ScopedBag));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿ç¨‹2æ‰§è¡Œ</span></span><br><span class="line">    ConcurrentBag&lt;MySingleton&gt; thread2SingletonBag = <span class="keyword">new</span> ConcurrentBag&lt;MySingleton&gt;();</span><br><span class="line">    ConcurrentBag&lt;MyTransient&gt; thread2TransientBag = <span class="keyword">new</span> ConcurrentBag&lt;MyTransient&gt;();</span><br><span class="line">    ConcurrentBag&lt;MyScoped&gt; thread2ScopedBag = <span class="keyword">new</span> ConcurrentBag&lt;MyScoped&gt;();</span><br><span class="line"></span><br><span class="line">    Thread thread2 = <span class="keyword">new</span> Thread(RunPerThreadWithScopedLifetime);</span><br><span class="line">    thread2.Start(<span class="keyword">new</span> Tuple&lt;IServiceProvider, ConcurrentBag&lt;MySingleton&gt;, ConcurrentBag&lt;MyTransient&gt;, ConcurrentBag&lt;MyScoped&gt;&gt;(sp, thread2SingletonBag, thread2TransientBag, thread2ScopedBag));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">    thread1.Join();</span><br><span class="line">    thread2.Join();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éªŒè¯æ‰€æœ‰ MySingleton çš„å®ä¾‹éƒ½æŒ‡å‘å†…å­˜é‡ŒåŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">    IEnumerable&lt;MySingleton&gt; singletons = thread1SingletonBag.Concat(thread2SingletonBag);</span><br><span class="line">    Console.WriteLine(<span class="string">$"Singleton: <span class="subst">{singletons.Count()}</span> objects are IDENTICAL? <span class="subst">{singletons.AreIdentical()}</span>"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éªŒè¯æ‰€æœ‰ MyTransient çš„å®ä¾‹éƒ½å„ä¸ç›¸åŒ</span></span><br><span class="line">    IEnumerable&lt;MyTransient&gt; transients = thread1TransientBag.Concat(thread2TransientBag);</span><br><span class="line">    Console.WriteLine(<span class="string">$"Transient: <span class="subst">{transients.Count()}</span> objects are DIFFERENT? <span class="subst">{transients.AreDifferent()}</span>"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹äºScopedç”Ÿå‘½å‘¨æœŸï¼Œæ¯ä¸ªçº¿ç¨‹é›†åˆå†…çš„å®ä¾‹åº”è¯¥æŒ‡å‘å†…å­˜é‡ŒåŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ2ä¸ªçº¿ç¨‹é›†åˆé‡Œçš„å®ä¾‹åº”è¯¥æ˜¯ä¸åŒçš„ã€‚</span></span><br><span class="line">    Console.WriteLine(<span class="string">$"collection of thread 1 has <span class="subst">{thread1ScopedBag.Count}</span> objects and they are IDENTICAL: <span class="subst">{thread1ScopedBag.AreIdentical()}</span>"</span>);</span><br><span class="line">    Console.WriteLine(<span class="string">$"collection of thread 2 has <span class="subst">{thread2ScopedBag.Count}</span> objects and they are IDENTICAL: <span class="subst">{thread2ScopedBag.AreIdentical()}</span>"</span>);</span><br><span class="line">    Console.WriteLine(<span class="string">$"the first object from thread 1 and the first object from thread 2 are IDENTICAL: <span class="subst">{Object.ReferenceEquals(thread1ScopedBag.First(), thread2ScopedBag.First())}</span>"</span>);</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¾“å‡ºç»“æœä¸ºï¼š</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RUNNING TryOutScoped</span><br><span class="line">Singleton: 20 objects are IDENTICAL? True</span><br><span class="line">Transient: 20 objects are DIFFERENT? True</span><br><span class="line">collection of thread 1 has 10 objects and they are IDENTICAL: True</span><br><span class="line">collection of thread 2 has 10 objects and they are IDENTICAL: True</span><br><span class="line">the first object from thread 1 and the first object from thread 2 are IDENTICAL: False</span><br></pre></td></tr></tbody></table></figure>

<p><em>æ¼”ç¤ºä»£ç å¯ä»¥ä»<a href="https://github.com/RickyLin/Demos/tree/master/ConsoleAppAndDI" target="_blank" rel="noopener">Github</a>ä¸Šè·å–ã€‚</em></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
	
	</div>
  <a type="button" href="/2016/11/30/console-app-and-di/#more" class="btn btn-default more">é˜…è¯»æ­¤æ–‡</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-10-15 </div>
			<div class="article-title"><a href="/2016/10/15/sql-server-internal-version/" >SQL Serverçš„å†…éƒ¨ç‰ˆæœ¬å·</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>SQL Serveråœ¨ä»æ•°æ®åº“å¤‡ä»½æ¢å¤æ•°æ®åº“çš„æ—¶å€™å¦‚æœæŠ¥é”™ï¼Œæœ‰æ—¶å€™ä¼šæç¤ºä¸€äº›å†…éƒ¨ç‰ˆæœ¬å·ã€‚é‚£ä¹ˆè¿™äº›å†…éƒ¨ç‰ˆæœ¬å·åˆ°åº•å¯¹åº”çš„æ˜¯å“ªä¸ªç‰ˆæœ¬çš„SQL Serverå‘¢ï¼Ÿ</p>
<p>è¿™ä¸ª<a href="http://sqlserverbuilds.blogspot.com/2014/01/sql-server-internal-database-versions.html" target="_blank" rel="noopener">æ–‡ç« </a>é‡Œæœ‰ç›¸å…³çš„åˆ—è¡¨ã€‚ä¸è¿‡å¿…é¡»ç§‘å­¦ä¸Šç½‘æ‰èƒ½è®¿é—®ã€‚ä¸ºäº†æ–¹ä¾¿é‚£äº›ä¸æ–¹ä¾¿ç§‘å­¦ä¸Šç½‘çš„åŒå­¦ï¼Œæˆ‘åœ¨è¿™é‡Œä»¥æˆªå›¾çš„å½¢å¼è´´å‡ºæ¥ã€‚</p>
<p><img src="SqlServerInternalVersion.png" alt="Sql Server Internal Versions"></p>
<p>å¦å¤–å¦‚æœä»ä¸Šé¢é‚£ä¸ªæ–‡ç« çš„è¿æ¥è·³åˆ°å®ƒçš„<a href="http://sqlserverbuilds.blogspot.com" target="_blank" rel="noopener">é¦–é¡µ</a>â€”â€”è¿™æ˜¯ä¸æ˜¯â€œå²ä¸Šâ€æœ€å…¨çš„SQL Server ç‰ˆæœ¬å·å¤§å…¨ï¼Ÿ</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
	
	</div>
  <a type="button" href="/2016/10/15/sql-server-internal-version/#more" class="btn btn-default more">é˜…è¯»æ­¤æ–‡</a>
</div>

           
		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
    	<li class="prev"><a href="/page/5/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i> ä¸Šä¸€é¡µ</a></li>
  		

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/7/" class="alignright next">ä¸‹ä¸€é¡µ<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			<div class="widget">
    
</div>

		
			
		
			
	<div class="widget">
		<h4>æ ‡ç­¾äº‘</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/Go-lang/">Go-lang<span>1</span></a></li>
		
			<li><a href="/tags/IIS/">IIS<span>1</span></a></li>
		
			<li><a href="/tags/ç®—æ³•/">ç®—æ³•<span>2</span></a></li>
		
			<li><a href="/tags/Office-365/">Office-365<span>2</span></a></li>
		
			<li><a href="/tags/ASP-NET-WebForm/">ASP.NET-WebForm<span>3</span></a></li>
		
			<li><a href="/tags/Oh-My-Zsh/">Oh-My-Zsh<span>1</span></a></li>
		
			<li><a href="/tags/NET/">.NET<span>4</span></a></li>
		
			<li><a href="/tags/ASP-NET-MVC/">ASP.NET-MVC<span>3</span></a></li>
		
			<li><a href="/tags/HTML/">HTML<span>1</span></a></li>
		
			<li><a href="/tags/XUnit/">XUnit<span>1</span></a></li>
		
			<li><a href="/tags/ASP-NET-Core/">ASP.NET-Core<span>3</span></a></li>
		
			<li><a href="/tags/EntityFramework/">EntityFramework<span>1</span></a></li>
		
			<li><a href="/tags/SQL-Server/">SQL-Server<span>7</span></a></li>
		
			<li><a href="/tags/Ruby/">Ruby<span>2</span></a></li>
		
			<li><a href="/tags/Windows/">Windows<span>2</span></a></li>
		
			<li><a href="/tags/7zip/">7zip<span>2</span></a></li>
		
			<li><a href="/tags/MacOS/">MacOS<span>1</span></a></li>
		
			<li><a href="/tags/JavaScript/">JavaScript<span>1</span></a></li>
		
			<li><a href="/tags/NET-Core/">.NET-Core<span>8</span></a></li>
		
			<li><a href="/tags/msbuild/">msbuild<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>30</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>æœ€æ–°æ–‡ç« </h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2019/07/28/install-xrdp-in-debian/" ><i class="fa fa-file-o"></i>åœ¨ Debian é‡Œå®‰è£… xrdp ä»¥é€šè¿‡ Windo...</a>
      </li>
    
      <li>
        <a href="/2019/07/21/setup-certificate-for-remote-desktop-connection/" ><i class="fa fa-file-o"></i>è®¾ç½® Windows è¿œç¨‹æ¡Œé¢ä½¿ç”¨æ­£ç¡®çš„åŸŸåè¯ä¹¦</a>
      </li>
    
      <li>
        <a href="/2019/03/06/rdlc-export-type/" ><i class="fa fa-file-o"></i>RDLC æ”¯æŒçš„å¯¼å‡ºæ ¼å¼</a>
      </li>
    
      <li>
        <a href="/2019/01/13/set-underscore-as-prefix-for-private-field-in-class-or-struct/" ><i class="fa fa-file-o"></i>åœ¨ VS 2017ä¸­è®¾ç½®è‡ªå®šä¹‰å‘½åè§„èŒƒâ€”â€”ç±»å‹ç§æœ‰å­—æ®µ...</a>
      </li>
    
      <li>
        <a href="/2018/05/20/add-new-tempdb-user-when-startup/" ><i class="fa fa-file-o"></i>è‡ªåŠ¨å‘ TempDB æ•°æ®åº“æ·»åŠ ç”¨æˆ·å’Œæƒé™</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>é“¾æ¥</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="http://www.github.com/rickylin" title="My Github account." target="_blank"]);">My Github</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->


    </div>
  </div>
  <div class="container-narrow">
    <footer> <div>
  <a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">
    <img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
  </a>
  <br />
  æœ¬ä½œå“é‡‡ç”¨<a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯ã€‚
</div>
<div>
  &copy; 2020 Ricky Lin
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/" target="_blank" rel="noopener">Freemind</a>.    
  </div> </footer>
  </div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>â–²</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




<!-- syntax highlighting -->


</body>
</html>