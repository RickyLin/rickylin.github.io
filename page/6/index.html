<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 6 页 | Ricky Lin</title>
  <meta name="author" content="Ricky Lin">
  
  <meta name="description" content="这是 Ricky Lin 的博客站点">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Ricky Lin"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/cerulean.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight-default.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/comment.css" media="screen" type="text/css">
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-sham.min.js"></script>
  <![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  
  <!-- analytics -->
  




  <script type="text/javascript">
    var sdkInstance="appInsightsSDK";window[sdkInstance]="appInsights";var aiName=window[sdkInstance],aisdk=window[aiName]||function(e){
      function n(e){t[e]=function(){var n=arguments;t.queue.push(function(){t[e].apply(t,n)})}}var t={config:e};t.initialize=!0;var i=document,a=window;setTimeout(function(){var n=i.createElement("script");n.src=e.url||"https://az416426.vo.msecnd.net/next/ai.2.min.js",i.getElementsByTagName("script")[0].parentNode.appendChild(n)});try{t.cookie=i.cookie}catch(e){}t.queue=[],t.version=2;for(var r=["Event","PageView","Exception","Trace","DependencyData","Metric","PageViewPerformance"];r.length;)n("track"+r.pop());n("startTrackPage"),n("stopTrackPage");var s="Track"+r[0];if(n("start"+s),n("stop"+s),n("setAuthenticatedUserContext"),n("clearAuthenticatedUserContext"),n("flush"),!(!0===e.disableExceptionTracking||e.extensionConfig&&e.extensionConfig.ApplicationInsightsAnalytics&&!0===e.extensionConfig.ApplicationInsightsAnalytics.disableExceptionTracking)){n("_"+(r="onerror"));var o=a[r];a[r]=function(e,n,i,a,s){var c=o&&o(e,n,i,a,s);return!0!==c&&t["_"+r]({message:e,url:n,lineNumber:i,columnNumber:a,error:s}),c},e.autoExceptionInstrumented=!0}return t
      }({
          instrumentationKey:"728568e9-6aa0-4b28-9466-4ba46620ade0"
      });
    
    window[aiName]=aisdk,aisdk.queue&&0===aisdk.queue.length&&aisdk.trackPageView({});
  </script>


<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">Ricky Lin</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/HelpfulLinks" title="Helpful links gathered from the Internet.">
			  <i class="fa fa-link"></i>Helpful Links
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
    <div class="content">
      <div class="page-header page-header-inverse ">
  <h1 class="title title-inverse ">学无止境</h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-heart"></i>
      理解得越多，需要记忆的越少
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
        <!-- render top articles firstly -->
        
        <!-- render other articles -->
        
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-13 </div>
			<div class="article-title"><a href="/2017/02/13/The-68-things-the-CLR-does-before-executing-a-single-line-of-your-code/" >The-68-things-the-CLR-does-before-executing-a-single-line-of-your-code</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>虽然已经没什么时间研究这么“底层”的知识了，但是依然觉得非常值得大略看一遍并收藏：</p>
<p><a href="http://mattwarren.org/2017/02/07/The-68-things-the-CLR-does-before-executing-a-single-line-of-your-code/" target="_blank" rel="noopener">The 68 things the CLR does before executing a single line of your code</a></p>
<p>这篇博文所在的<a href="http://mattwarren.org" target="_blank" rel="noopener">博客</a>有很多非常有深度的内容，值得经常拜读一下。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
	
	</div>
  <a type="button" href="/2017/02/13/The-68-things-the-CLR-does-before-executing-a-single-line-of-your-code/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-13 </div>
			<div class="article-title"><a href="/2017/02/13/implicit-metapackage-package-reference-in-the-dotnet-core-sdk/" >Implicit metapackage package reference in the .NET Core SDK - Visual Studio 2017 RC3</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>从此默认不需要再引用 Microsoft.NETCore.App 或者 NetStandard.Library 了：</p>
<p><a href="https://github.com/dotnet/core/blob/master/release-notes/1.0/sdk/1.0-rc3-implicit-package-refs.md" target="_blank" rel="noopener">Implicit metapackage package reference in the .NET Core SDK - Visual Studio 2017 RC3</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
	
	</div>
  <a type="button" href="/2017/02/13/implicit-metapackage-package-reference-in-the-dotnet-core-sdk/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-09 </div>
			<div class="article-title"><a href="/2017/02/09/uninstall-dotnet-core/" >在Mac OS里卸载 dotnet core</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>都说 Mac OS 比 Windows 更容易卸载软件，其实，我并不觉得。尤其是那些通过 pkg 方式安装的软件。 鉴于 dotnet core sdk 也是经常升级的，我并不希望在 Mac OS 里留有2套 dotnet core，于是如何卸载就成了一个问题。好在这个问题的解决比想象中容易，因为有现成的<a href="https://github.com/dotnet/cli/blob/rel/1.0.0/scripts/obtain/uninstall/dotnet-uninstall-pkgs.sh" target="_blank" rel="noopener">官方脚本</a>可以使用。从此我应该可以更放心大胆地当小白鼠了。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
	
	</div>
  <a type="button" href="/2017/02/09/uninstall-dotnet-core/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-11-30 </div>
			<div class="article-title"><a href="/2016/11/30/console-app-and-di/" >Console app 里的依赖注入及其实例生命周期</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>依赖注入是 ASP.NET Core 里的核心概念之一，我们平常总是愉快地在<code>Startup</code>类的<code>ConfigureServices</code>方法里往<code>IServiceCollection</code>里注册各种类型，以致有一些同学可能误以为依赖注入是只有 ASP.NET Core 才有的特性。但实际上依赖注入也可以用于 .NET Core 的 Console app. 别忘了， ASP.NET Core 的应用本质上也只是一个 Console app而已。今天我们在Console app里试试依赖注入。</p>
<p>我们的目标是创建一个Console app，在其中引入依赖注入，注册不同生命周期的类型，然后创建几个线程，每个线程分别依靠依赖注入“创建”若干类型实例，然后观察不同生命周期下这些实例变量是否指向一个实例还是各不相同。</p>
<h2 id="ServiceCollection"><a href="#ServiceCollection" class="headerlink" title="ServiceCollection"></a>ServiceCollection</h2><p>现在闭上眼睛想象一下（别睡着了），我们自己就是依赖注入的执行者，如果有一个漂亮的程序媛跟我们说她要某某类型的一个实例，我们应该怎么做？我们首先需要知道这某某类型是个什么东西以及如何创建对吧？我们如何知道呢？当然是她得提前告诉我们啊，而我们要有个地方把这些信息保留下来然后在需要的时候可以查阅。在 .NET Core里，可以依赖注入的类型叫<code>Service</code>，而记录这些<code>Service</code>信息的这地方就是<code>ServiceCollection</code>。</p>
<p>所以，当程序运行起来之后，我们第一件事情就是创建一个<code>ServiceCollection</code>，怎么创建呢？ <code>new</code> 呗</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// using Microsoft.Extensions.DependencyInjection</span></span><br><span class="line">ServiceCollection services = <span class="keyword">new</span> ServiceCollection();</span><br></pre></td></tr></tbody></table></figure>

<p>听起来高大上的<code>ServiceCollection</code>，其创建竟然如此简单。<span class="github-emoji" style="display:inline;color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f613.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f613.png?v8">😓</span></p>
<h2 id="IServiceProvider"><a href="#IServiceProvider" class="headerlink" title="IServiceProvider"></a>IServiceProvider</h2><p>看着 <code>ServiceCollection</code>里眼花缭乱的各种类型，我们心中充满自信，“妹子，说吧，你想要哪个类型的实例？”，妹子一脸不乐意“要你个头，我两手空空拿什么去取类型的实例？”……对啊，我们总得给人家一个什么东西，然后人家可以用它从<code>ServiceCollection</code>里获取实例啊。。。这东西就是<code>IServiceProvider</code>，我们的<code>ServiceCollection</code>可以生成一个<code>IServiceProvider</code>，而任何类型的对象，只要有这个<code>IServiceProvider</code>就可以从我们的<code>ServiceCollection</code>里获取实例。</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ServiceCollection services = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向services注册各种类型</span></span><br><span class="line"></span><br><span class="line">IServiceProvider sp = services.BuildServiceProvider();</span><br><span class="line"></span><br><span class="line"><span class="comment">//从此以后，任何握有 sp 的对象可以从ServiceCollection里获取实例。</span></span><br></pre></td></tr></tbody></table></figure>

<p>有趣的是， <code>IServiceProvider</code>是<code>System</code>命名空间下的。</p>
<h2 id="Service的生命周期"><a href="#Service的生命周期" class="headerlink" title="Service的生命周期"></a>Service的生命周期</h2><p>自脱离 ASP.NET Web Form 的世界以来，已经很少听到、看到“生命周期”这个词了。遥想当年无论是面试还是被面试，“ASP.NET 页面的生命周期”那简直是必备问题 —— 跑题了。</p>
<p>还是闭上眼睛（还是别睡着了），想象一下，还是那个漂亮的程序媛，她略带娇嗔地对我们说：“好哥哥，帮我把这个某某类型注册到依赖注入里吧，可以吗？”，既然我们现在有了<code>ServiceCollection</code>，注册当然不成问题～，但再仔细想想，当我们把某某类型添加到<code>ServiceCollection</code>，继而创建出一个<code>IServiceProvider</code>给程序媛妹子，接着程序媛妹子不停地从<code>ServiceCollection</code>里获取实例时，她得到的是同一个实例呢还是每次请求都给她一个新的实例？谁知道，得问她才知道。所以平常不擅言辞、从不废话的我们不能浪费这次交流的机会，在程序媛妹子让我们注册类型的时候我们还要问清楚她想怎样得到这个类型的实例，每次都给她一个新的，还是总给她同一个？换句话说，当一个<code>Service</code>被注册到<code>ServiceCollection</code>的时候，我们需要同时知道它的类型和实例生命周期。</p>
<p><code>ServiceCollection</code>很体贴，我们可以直接用不同的注册方法注册不同生命周期的<code>Service</code>：</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AddTransient 方法将一个类型注册为 Transient 生命周期。因此，每一次你从依赖注入中请求一个 MyTransientClass 实例，你都会得到一个全新实例化的实例。请求10次，就得到10个不同的实例。</span></span><br><span class="line">service.AddTransient&lt;MyTransientClass&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// AddSingleton 方法将一个类型注册为 Singleton 生命周期。单体大家都懂，就是无论请求多少次，你从依赖注入都会得到同一个 MySingletonClass 实例。请求10次，得到的却是同一个实例。</span></span><br><span class="line">service.AddSingleton&lt;MySingletonClass&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// AddScoped 方法将一个类型注册为 Scoped 生命周期。这个生命周期比较特别。如果你的程序里创建了若干个 "Scope"，依赖注入会确保在同一个 Scope 里，你将得到同一个 MyScopedClass 实例，而不同 Scope 里的 MyScopedClass 实例是不同的</span></span><br><span class="line"><span class="comment">// 假设你有3个Scope，每个Scope里请求10次，那么你将得到3个不同的 MyScopedClass 实例。其中每个 Scope 里一个。</span></span><br><span class="line"><span class="comment">// 至于 Scope 到底是什么含义，这就因程序而异了。比如在 ASP.NET Core 里，一个Scope意味着一次浏览器请求往返。而在我们的示例程序里，一个Scope代表一个线程内部。</span></span><br><span class="line">service.AddScoped&lt;MyScopedClass&gt;();</span><br></pre></td></tr></tbody></table></figure>

<p>以上3个生命周期类型基本上涵盖了所有可能的场景：</p>
<ol>
<li>每次都要新实例。</li>
<li>永远都只需要同一个实例。</li>
<li>在一个范围之内只需要同一个实例，但是不同范围之内的实例要不同。</li>
</ol>
<h2 id="醒醒，无聊的理论时间过去了，Demo-上场了"><a href="#醒醒，无聊的理论时间过去了，Demo-上场了" class="headerlink" title="醒醒，无聊的理论时间过去了，Demo 上场了"></a>醒醒，无聊的理论时间过去了，Demo 上场了</h2><p>说书者曰“闲话休提，且说正话”，咱们也到了“理论休提，且看Demo”的时候了。 .NET Core 的一大优点是命令行友好，并且不用特别依靠功能强大但臃肿的 Visual Studio来开发。我的Demo是在 MacOS + .NET Core CLI (v1.1) + Visual Studio Code 环境下创建和运行的。这套环境在其它平台下的体验几乎没什么区别。</p>
<p>首先打开一个命令行，创建一个目录，然后在新创建的目录里执行 <code>dotnet new</code>命令。这将创建一个最简单的 Console App.</p>
<p><img src="create_console_app.png" alt="create console app"></p>
<p>注意，利用 <code>dotnet new</code> 创建的文件竟然加了可执行属性（所以显示为红色），这应该是个bug，并且会在未来的版本里修复。最后运行 <code>code .</code>会把当前目录在 Visual Studio Code 里打开，然后我们就可以写代码了。</p>
<h2 id="STEP-1-添加对-Microsoft-Extensions-DependencyInjection-的引用"><a href="#STEP-1-添加对-Microsoft-Extensions-DependencyInjection-的引用" class="headerlink" title="STEP 1: 添加对 Microsoft.Extensions.DependencyInjection 的引用"></a>STEP 1: 添加对 Microsoft.Extensions.DependencyInjection 的引用</h2><p>首先，我们需要添加一个引用：<code>Microsoft.Extensions.DependencyInjection</code>，依赖注入的默认实现都在里面。</p>
<p>打开 <code>project.json</code>，然后在<code>dependencies</code>里添加引用。添加完成之后，<code>project.json</code>应该看起来是这样的：</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0-*"</span>,</span><br><span class="line">  <span class="attr">"buildOptions"</span>: {</span><br><span class="line">    <span class="attr">"debugType"</span>: <span class="string">"portable"</span>,</span><br><span class="line">    <span class="attr">"emitEntryPoint"</span>: <span class="literal">true</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"dependencies"</span>: {</span><br><span class="line">    <span class="attr">"Microsoft.Extensions.DependencyInjection"</span>: <span class="string">"1.1.0"</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"frameworks"</span>: {</span><br><span class="line">    <span class="attr">"netcoreapp1.1"</span>: {</span><br><span class="line">      <span class="attr">"dependencies"</span>: {</span><br><span class="line">        <span class="attr">"Microsoft.NETCore.App"</span>: {</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"platform"</span>,</span><br><span class="line">          <span class="attr">"version"</span>: <span class="string">"1.1.0"</span></span><br><span class="line">        }</span><br><span class="line">      },</span><br><span class="line">      <span class="attr">"imports"</span>: <span class="string">"dnxcore50"</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>添加好引用之后，保存，这时 VS Code的顶部应该会有个提示，说”There are unresolved dependencies from ‘project.json’. Please execute the restore command to continue.”，你可以直接点“Restore”按钮或者手工在命令行里运行 <code>dotnet restore</code>命令来还原依赖。</p>
<p>如果你观察新创建的 ASP.NET Core 程序的 project.json 文件，你可能会发现依赖列表里并没有<code>Microsoft.Extensions.DependencyInjection</code>，那为什么我们在这里需要添加这个引用呢？这是因为你的 project.json 文件里有 ASP.NET Core 的引用，比如 <code>Microsoft.AspNetCore.Mvc</code>，而它或者它依赖的引用里有对<code>Microsoft.Extensions.DependencyInjection</code>的引用。因此你的 ASP.NET Core程序其实是间接的引用了<code>Microsoft.Extensions.DependencyInjection</code>。我们的示例程序里“干净”得很，所以必须直接添加对<code>Microsoft.Extensions.DependencyInjection</code>的引用。</p>
<p><em>注意，我是使用 1.1 版本的 .NET Core，所以引用的版本号都是“1.1.0”，如果你使用的是1.0.0或1.0.1版本的 .NET Core，那么这里的版本号会有所不同。</em></p>
<h2 id="STEP2：-准备工作"><a href="#STEP2：-准备工作" class="headerlink" title="STEP2： 准备工作"></a>STEP2： 准备工作</h2><p>在我们的示例程序引入依赖注入之前，有几项准备工作要做。</p>
<p><strong>首先，</strong> 我们需要一个可以注册到依赖注入的类型，这个简单：</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyClass</span> { }</span><br></pre></td></tr></tbody></table></figure>

<p><strong>其次，</strong> 我们需要某种方法来检测从依赖注入中得到的类型实例是相同的还是不同的。什么叫相同？就是这些实例都指向内存里的同一个对象。对此，我们可以利用<code>Object</code>类型的静态方法<code>ReferenceEquals</code>来检测。顾名思义，无需解释。但是这个方法本身只能针对2个实例进行检测，我们的示例程序想一次得到10个实例引用，怎么检测这10个实例引用是相同还是不同？记得写SQL语句的时候，有个关键字叫<code>Distinct</code>，它可以剔除集合中的重复项。而我们引以为傲的LINQ同样支持<code>Distinct</code>，我们可以把所有实例放到一个集合，然后对集合进行<code>Distinct</code>操作，如果结果是<code>1</code>，说明集合里所有的实例其实指向同一个对象；如果结果等于集合原本的元素个数，那说明集合里每一个对象都是互不相同的。</p>
<p>鉴于我们使用多个线程向集合里插入数据，我们需要一个多线程安全的集合类型：<code>System.Collections.Concurrent.ConcurrentBag&lt;T&gt;</code>。</p>
<p>而调用<code>Distinct</code>方法的时候，我们希望它可以明确地以<code>ReferenceEquals</code>的方式比较，这一点可以通过创建一个实现<code>IEqualityComparer&lt;T&gt;</code>接口的类<code>ReferenceEqualComparer&lt;T&gt;</code>来做到。</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class ReferenceEqualComparer&lt;T&gt; : IEqualityComparer&lt;T&gt;</span><br><span class="line">{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">Equals</span>(<span class="params">T x, T y</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">return</span> Object.ReferenceEquals(x, y);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetHashCode</span>(<span class="params">T obj</span>)</span></span><br><span class="line"><span class="function"></span>    {</span><br><span class="line">        <span class="keyword">return</span> obj.GetHashCode();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>然后，</strong> 我们创建两个<code>IEnumerable&lt;T&gt;</code>上的扩展方法来简化比较操作。</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">IEnumerableExtensions</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> AreIdentical&lt;T&gt;(<span class="keyword">this</span> IEnumerable&lt;T&gt; bag)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> bag.Distinct(<span class="keyword">new</span> ReferenceEqualComparer&lt;T&gt;()).Count() == <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> AreDifferent&lt;T&gt;(<span class="keyword">this</span> IEnumerable&lt;T&gt; bag)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">return</span> bag.Distinct(<span class="keyword">new</span> ReferenceEqualComparer&lt;T&gt;()).Count() == bag.Count();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>最后，</strong> 我们创建一个统一的方法，这个方法可以传入一个<code>ServiceCollection</code>对象，然后我们从中获取<code>IServiceProvider</code>，再创建10个线程分别利用<code>IServiceProvider</code>获取服务实例，插入到一个集合中并返回这个集合。</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConcurrentBag&lt;MyClass&gt; <span class="title">GetObjectsFromDI</span>(<span class="params">ServiceCollection services</span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">int</span> threadCount = <span class="number">10</span>;</span><br><span class="line">    IServiceProvider sp = services.BuildServiceProvider();</span><br><span class="line">    ConcurrentBag&lt;MyClass&gt; bag = <span class="keyword">new</span> ConcurrentBag&lt;MyClass&gt;();</span><br><span class="line">    Thread[] threads = <span class="keyword">new</span> Thread[threadCount];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; threadCount; i++)</span><br><span class="line">    {</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(RunPerThread);</span><br><span class="line">        threads[i] = thread;</span><br><span class="line">        thread.Start(<span class="keyword">new</span> Tuple&lt;IServiceProvider, ConcurrentBag&lt;MyClass&gt;&gt;(sp, bag));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 确保所有线程都执行完毕之后再继续</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; threadCount; i++)</span><br><span class="line">    {</span><br><span class="line">        threads[i].Join();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bag;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RunPerThread</span>(<span class="params"><span class="keyword">object</span> threadParam</span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Tuple&lt;IServiceProvider, ConcurrentBag&lt;MyClass&gt;&gt; args = threadParam <span class="keyword">as</span> Tuple&lt;IServiceProvider, ConcurrentBag&lt;MyClass&gt;&gt;;</span><br><span class="line">    IServiceProvider sp = args.Item1;</span><br><span class="line">    ConcurrentBag&lt;MyClass&gt; bag = args.Item2;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    {</span><br><span class="line">        bag.Add(sp.GetRequiredService&lt;MyClass&gt;());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>以上的准备工作使我们接下来的验证操作变得容易了很多。</p>
<h2 id="STEP-3-验证-Singleton-生命周期"><a href="#STEP-3-验证-Singleton-生命周期" class="headerlink" title="STEP 3: 验证 Singleton 生命周期"></a>STEP 3: 验证 Singleton 生命周期</h2><p>我们创建一个方法<code>TryOutSingleton</code>来验证 Singleton 生命周期</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TryOutSingleton</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    ServiceCollection services = <span class="keyword">new</span> ServiceCollection(); <span class="comment">// 准备好我们的容器</span></span><br><span class="line">    services.AddSingleton&lt;MyClass&gt;(); <span class="comment">//把MyClass注册为 Singleton 生命周期 </span></span><br><span class="line"></span><br><span class="line">    ConcurrentBag&lt;MyClass&gt; bag = GetObjectsFromDI(services); <span class="comment">// 调用我们准备好的方法，用若干线程从 IServiceProvider 中获取 MyClass 实例，并加入到集合</span></span><br><span class="line"></span><br><span class="line">    Console.WriteLine(bag.AreIdentical()); <span class="comment">// 验证集合中的所有元素是否指向内存中的同一个对象。</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>不出所料，最后输出的结果是：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></tbody></table></figure>

<h2 id="STEP-4-验证-Transient-生命周期"><a href="#STEP-4-验证-Transient-生命周期" class="headerlink" title="STEP 4: 验证 Transient 生命周期"></a>STEP 4: 验证 Transient 生命周期</h2><p>再创建一个 <code>TryOutTransient</code> 方法验证 Transient 生命周期</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TryOutTransient</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    ServiceCollection services = <span class="keyword">new</span> ServiceCollection(); <span class="comment">// 准备好我们的容器</span></span><br><span class="line">    services.AddTransient&lt;MyClass&gt;(); <span class="comment">//把MyClass注册为 Transient 生命周期 </span></span><br><span class="line"></span><br><span class="line">    ConcurrentBag&lt;MyClass&gt; bag = GetObjectsFromDI(services); <span class="comment">// 调用我们准备好的方法，用若干线程从 IServiceProvider 中获取 MyClass 实例，并加入到集合</span></span><br><span class="line">    </span><br><span class="line">    Console.WriteLine(bag.AreDifferent()); <span class="comment">// 验证集合中的所有元素是否各不相同</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>同样不出意外，输出结果是：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></tbody></table></figure>

<h2 id="STEP-5-Scoped-生命周期"><a href="#STEP-5-Scoped-生命周期" class="headerlink" title="STEP 5: Scoped 生命周期"></a>STEP 5: Scoped 生命周期</h2><p>前面提到过， Scoped 生命周期比较特别，同一个Scope里的实例是同一个，但是不同Scope里的实例是不同的。而Scope具体的含义取决于我们自己的定义。</p>
<p>具体到代码级别，当我们需要创建一个Scope的时候，我们需要用到我们之前得到的<code>IServiceProvider</code>，它有一个<code>CreateScope</code>方法可以创建一个类型为<code>Microsoft.Extensions.DependencyInjection.IServiceScope</code>的Scope，而这个Scope实例有一个<code>IServiceProvider</code>类型的属性<code>ServiceProvider</code>！自此，我们应该使用这个来自<code>IServiceScope</code>的<code>IServiceProvider</code>（取代之前我们得到的<code>IServiceProvider</code>）来获取服务实例，它会正确处理Singleton, Transient以及Scoped这3种生命周期!</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ServiceCollection services = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">IServiceProvider serviceProvider = services.BuildServiceProvider();</span><br><span class="line"></span><br><span class="line">IServiceScope scope = serviceProvider.CreateScope();</span><br><span class="line"></span><br><span class="line">IServiceProvider newServiceProvider = scope.ServiceProvider; <span class="comment">// 以后靠它来正确处理 Singleton, Transient 和 Scoped 生命周期的实例</span></span><br><span class="line"></span><br><span class="line">MyClass obj = newServiceProvider.GetRequiredService&lt;MyClass&gt;(); <span class="comment">// 无论MyClass是哪种生命周期类型，这里都可以得到正确的实例。</span></span><br></pre></td></tr></tbody></table></figure>

<p>为了验证Scoped生命周期，我们现在定义Scope为线程空间。也就是说，每一个线程为一个Scope，对于Scoped生命周期的类型，在同一个线程之内获取的实例应该是同一个，但是不同线程获取的实例是不同的。</p>
<p>在演示代码中，我们注册3个不同的类型，分别对应3种不同的生命周期，看看来自<code>IServiceScope</code>的<code>IServiceProvider</code>能否正确处理每一种生命周期类型。</p>
<p>代码有些啰嗦，因为不想再拆分成更小的方法了：</p>
<figure class="highlight csharp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">public class MySingleton { }</span></span><br><span class="line"><span class="comment">public class MyTransient { }</span></span><br><span class="line"><span class="comment">public class MyScoped { }</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">TryOutScoped</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Console.WriteLine(<span class="string">$"RUNNING <span class="subst">{<span class="keyword">nameof</span>(TryOutScoped)}</span>"</span>);</span><br><span class="line"></span><br><span class="line">    ServiceCollection services = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line">    services.AddSingleton&lt;MySingleton&gt;();</span><br><span class="line">    services.AddTransient&lt;MyTransient&gt;();</span><br><span class="line">    services.AddScoped&lt;MyScoped&gt;();</span><br><span class="line"></span><br><span class="line">    IServiceProvider sp = services.BuildServiceProvider();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 线程1执行</span></span><br><span class="line">    ConcurrentBag&lt;MySingleton&gt; thread1SingletonBag = <span class="keyword">new</span> ConcurrentBag&lt;MySingleton&gt;();</span><br><span class="line">    ConcurrentBag&lt;MyTransient&gt; thread1TransientBag = <span class="keyword">new</span> ConcurrentBag&lt;MyTransient&gt;();</span><br><span class="line">    ConcurrentBag&lt;MyScoped&gt; thread1ScopedBag = <span class="keyword">new</span> ConcurrentBag&lt;MyScoped&gt;();</span><br><span class="line"></span><br><span class="line">    Thread thread1 = <span class="keyword">new</span> Thread(RunPerThreadWithScopedLifetime);</span><br><span class="line">    thread1.Start(<span class="keyword">new</span> Tuple&lt;IServiceProvider, ConcurrentBag&lt;MySingleton&gt;, ConcurrentBag&lt;MyTransient&gt;, ConcurrentBag&lt;MyScoped&gt;&gt;(sp, thread1SingletonBag, thread1TransientBag, thread1ScopedBag));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 线程2执行</span></span><br><span class="line">    ConcurrentBag&lt;MySingleton&gt; thread2SingletonBag = <span class="keyword">new</span> ConcurrentBag&lt;MySingleton&gt;();</span><br><span class="line">    ConcurrentBag&lt;MyTransient&gt; thread2TransientBag = <span class="keyword">new</span> ConcurrentBag&lt;MyTransient&gt;();</span><br><span class="line">    ConcurrentBag&lt;MyScoped&gt; thread2ScopedBag = <span class="keyword">new</span> ConcurrentBag&lt;MyScoped&gt;();</span><br><span class="line"></span><br><span class="line">    Thread thread2 = <span class="keyword">new</span> Thread(RunPerThreadWithScopedLifetime);</span><br><span class="line">    thread2.Start(<span class="keyword">new</span> Tuple&lt;IServiceProvider, ConcurrentBag&lt;MySingleton&gt;, ConcurrentBag&lt;MyTransient&gt;, ConcurrentBag&lt;MyScoped&gt;&gt;(sp, thread2SingletonBag, thread2TransientBag, thread2ScopedBag));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等待执行完毕</span></span><br><span class="line">    thread1.Join();</span><br><span class="line">    thread2.Join();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证所有 MySingleton 的实例都指向内存里同一个对象</span></span><br><span class="line">    IEnumerable&lt;MySingleton&gt; singletons = thread1SingletonBag.Concat(thread2SingletonBag);</span><br><span class="line">    Console.WriteLine(<span class="string">$"Singleton: <span class="subst">{singletons.Count()}</span> objects are IDENTICAL? <span class="subst">{singletons.AreIdentical()}</span>"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证所有 MyTransient 的实例都各不相同</span></span><br><span class="line">    IEnumerable&lt;MyTransient&gt; transients = thread1TransientBag.Concat(thread2TransientBag);</span><br><span class="line">    Console.WriteLine(<span class="string">$"Transient: <span class="subst">{transients.Count()}</span> objects are DIFFERENT? <span class="subst">{transients.AreDifferent()}</span>"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对于Scoped生命周期，每个线程集合内的实例应该指向内存里同一个对象，而2个线程集合里的实例应该是不同的。</span></span><br><span class="line">    Console.WriteLine(<span class="string">$"collection of thread 1 has <span class="subst">{thread1ScopedBag.Count}</span> objects and they are IDENTICAL: <span class="subst">{thread1ScopedBag.AreIdentical()}</span>"</span>);</span><br><span class="line">    Console.WriteLine(<span class="string">$"collection of thread 2 has <span class="subst">{thread2ScopedBag.Count}</span> objects and they are IDENTICAL: <span class="subst">{thread2ScopedBag.AreIdentical()}</span>"</span>);</span><br><span class="line">    Console.WriteLine(<span class="string">$"the first object from thread 1 and the first object from thread 2 are IDENTICAL: <span class="subst">{Object.ReferenceEquals(thread1ScopedBag.First(), thread2ScopedBag.First())}</span>"</span>);</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>输出结果为：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RUNNING TryOutScoped</span><br><span class="line">Singleton: 20 objects are IDENTICAL? True</span><br><span class="line">Transient: 20 objects are DIFFERENT? True</span><br><span class="line">collection of thread 1 has 10 objects and they are IDENTICAL: True</span><br><span class="line">collection of thread 2 has 10 objects and they are IDENTICAL: True</span><br><span class="line">the first object from thread 1 and the first object from thread 2 are IDENTICAL: False</span><br></pre></td></tr></tbody></table></figure>

<p><em>演示代码可以从<a href="https://github.com/RickyLin/Demos/tree/master/ConsoleAppAndDI" target="_blank" rel="noopener">Github</a>上获取。</em></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
	
	</div>
  <a type="button" href="/2016/11/30/console-app-and-di/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-10-15 </div>
			<div class="article-title"><a href="/2016/10/15/sql-server-internal-version/" >SQL Server的内部版本号</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>SQL Server在从数据库备份恢复数据库的时候如果报错，有时候会提示一些内部版本号。那么这些内部版本号到底对应的是哪个版本的SQL Server呢？</p>
<p>这个<a href="http://sqlserverbuilds.blogspot.com/2014/01/sql-server-internal-database-versions.html" target="_blank" rel="noopener">文章</a>里有相关的列表。不过必须科学上网才能访问。为了方便那些不方便科学上网的同学，我在这里以截图的形式贴出来。</p>
<p><img src="SqlServerInternalVersion.png" alt="Sql Server Internal Versions"></p>
<p>另外如果从上面那个文章的连接跳到它的<a href="http://sqlserverbuilds.blogspot.com" target="_blank" rel="noopener">首页</a>——这是不是“史上”最全的SQL Server 版本号大全？</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
	
	</div>
  <a type="button" href="/2016/10/15/sql-server-internal-version/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
    	<li class="prev"><a href="/page/5/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i> 上一页</a></li>
  		

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/7/" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			<div class="widget">
    
</div>

		
			
		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/Go-lang/">Go-lang<span>1</span></a></li>
		
			<li><a href="/tags/IIS/">IIS<span>1</span></a></li>
		
			<li><a href="/tags/算法/">算法<span>2</span></a></li>
		
			<li><a href="/tags/Office-365/">Office-365<span>2</span></a></li>
		
			<li><a href="/tags/ASP-NET-WebForm/">ASP.NET-WebForm<span>3</span></a></li>
		
			<li><a href="/tags/Oh-My-Zsh/">Oh-My-Zsh<span>1</span></a></li>
		
			<li><a href="/tags/NET/">.NET<span>4</span></a></li>
		
			<li><a href="/tags/ASP-NET-MVC/">ASP.NET-MVC<span>3</span></a></li>
		
			<li><a href="/tags/HTML/">HTML<span>1</span></a></li>
		
			<li><a href="/tags/XUnit/">XUnit<span>1</span></a></li>
		
			<li><a href="/tags/ASP-NET-Core/">ASP.NET-Core<span>3</span></a></li>
		
			<li><a href="/tags/EntityFramework/">EntityFramework<span>1</span></a></li>
		
			<li><a href="/tags/SQL-Server/">SQL-Server<span>7</span></a></li>
		
			<li><a href="/tags/Ruby/">Ruby<span>2</span></a></li>
		
			<li><a href="/tags/Windows/">Windows<span>2</span></a></li>
		
			<li><a href="/tags/7zip/">7zip<span>2</span></a></li>
		
			<li><a href="/tags/MacOS/">MacOS<span>1</span></a></li>
		
			<li><a href="/tags/JavaScript/">JavaScript<span>1</span></a></li>
		
			<li><a href="/tags/NET-Core/">.NET-Core<span>8</span></a></li>
		
			<li><a href="/tags/msbuild/">msbuild<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>30</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2019/07/28/install-xrdp-in-debian/" ><i class="fa fa-file-o"></i>在 Debian 里安装 xrdp 以通过 Windo...</a>
      </li>
    
      <li>
        <a href="/2019/07/21/setup-certificate-for-remote-desktop-connection/" ><i class="fa fa-file-o"></i>设置 Windows 远程桌面使用正确的域名证书</a>
      </li>
    
      <li>
        <a href="/2019/03/06/rdlc-export-type/" ><i class="fa fa-file-o"></i>RDLC 支持的导出格式</a>
      </li>
    
      <li>
        <a href="/2019/01/13/set-underscore-as-prefix-for-private-field-in-class-or-struct/" ><i class="fa fa-file-o"></i>在 VS 2017中设置自定义命名规范——类型私有字段...</a>
      </li>
    
      <li>
        <a href="/2018/05/20/add-new-tempdb-user-when-startup/" ><i class="fa fa-file-o"></i>自动向 TempDB 数据库添加用户和权限</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="http://www.github.com/rickylin" title="My Github account." target="_blank"]);">My Github</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->


    </div>
  </div>
  <div class="container-narrow">
    <footer> <div>
  <a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">
    <img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
  </a>
  <br />
  本作品采用<a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。
</div>
<div>
  &copy; 2020 Ricky Lin
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/" target="_blank" rel="noopener">Freemind</a>.    
  </div> </footer>
  </div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




<!-- syntax highlighting -->


</body>
</html>